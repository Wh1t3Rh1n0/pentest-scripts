#!/bin/bash

##
## Kali Linux: Extra tools and customizations script
## =================================================
## Created by Wh1t3Rh1n0
##
## This script adds a bunch of my favorite tools to Kali Linux.
##
## Usage: ./Kali_Linux_Extra_Tools.sh install
##

if [ "$1" == "" ] || [ "$1" == "-h" ] || [ "$1" == "--help" ]; then
    grep "^##" "$0"
    exit
fi

if [ "$1" != "install" ]; then exit ; fi


# ====== Kali Linux Extra Tools ======
apt-get update && apt-get -y upgrade && apt-get -y dist-upgrade

# Configuration changes (convenience)
echo -e "\nPATH=\$PATH:/opt/pentest-scripts" >> /root/.bashrc
update-rc.d postgresql enable
update-rc.d metasploit enable


# Firefox/Iceweasel Add-ons
# -------------------------
echo "Opening Iceweasel to install addons..."

URLS="https://addons.mozilla.org/en-US/firefox/addon/open-multiple-locations/
https://addons.mozilla.org/en-US/firefox/addon/restclient/?src=search
https://addons.mozilla.org/en-US/firefox/addon/refcontrol/?src=search
https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/?src=ss
https://addons.mozilla.org/en-US/firefox/addon/firebug/?src=search
https://addons.mozilla.org/en-US/firefox/addon/cookies-manager-plus/?src=ss
https://addons.mozilla.org/en-US/firefox/addon/unhide-passwords/
https://addons.mozilla.org/en-US/firefox/addon/hackbar/?src=search
https://addons.mozilla.org/en-US/firefox/addon/tamper-data/?src=search
https://addons.mozilla.org/en-US/firefox/addon/quickjava/?src=search
https://addons.mozilla.org/en-US/firefox/addon/parent-folder/
https://addons.mozilla.org/en-US/firefox/addon/user-agent-quick-switch
https://addons.mozilla.org/en-US/firefox/addon/email-extractor
https://addons.mozilla.org/en-US/firefox/addon/autofill-262804/
https://addons.mozilla.org/en-US/firefox/addon/unhide-fields
https://addons.mozilla.org/en-US/firefox/addon/adblock-plus/?src=search
https://addons.mozilla.org/en-us/firefox/addon/checkcompatibility/
"
iceweasel &

for url in $(echo $URLS); do
  iceweasel "$url"
  sleep 0.5
done



# Tools you must download manually
# --------------------------------

# PHP File Manager - for easy upload/download over kali's apache or victim's HTTP server
# http://phpfm.sourceforge.net/


# Tools installed with apt-get
# ----------------------------

# cifs-utils -> mount.cifs - mount SMB shares as local directories
# sshfs - mount SSH servers
# sshpass - pass ssh passwords in the command-line (scripting, preventing typos)
# vinagre - a more fully-featured VNC/RDP client
apt-get install -y cifs-utils sshfs sshpass vinagre

# Tools based on personal preference
apt-get install -y terminator gedit hexchat gnome-tweak-tool

# Other stuff that comes in handy
apt-get install -y flashplugin-nonfree icedtea-plugin
apt-get install -y gimp
apt-get install -y libreoffice-gnome libreoffice-writer libreoffice-calc


# Scripted, non-apt-get installs
# ------------------------------

# Wordlists ###
cd /usr/share/wordlists
# Top 10k most common passwords: 
wget "https://xato.net/files/10k%20most%20common.zip"
# Top 100 passwords from the Adobe leak: http://stricture-group.com/files/adobe-top100.txt
# * This one needs some formatting:
curl "http://stricture-group.com/files/adobe-top100.txt" | grep "^[0-9]*\." | awk -F " " {'print $4'} > /usr/share/wordlists/adobe-top-100.txt
# Default passwords list: 
wget "http://www.phenoelit.org/dpl/dpl.html"

# merger.py -> nessus-merger.py
wget "https://gist.githubusercontent.com/mastahyeti/2720173/raw" -O /tmp/merger.py
echo \#\!/usr/bin/env python > /usr/share/nessus-merger.py
cat /tmp/merger.py >> /usr/share/nessus-merger.py
chmod 755 /usr/share/nessus-merger.py
rm /tmp/merger.py

# VNCpwd - VNC Password Decrypter
mkdir /opt/vncpwd
cd /opt/vncpwd
wget "http://aluigi.altervista.org/pwdrec/vncpwd.zip"
unzip vncpwd.zip

# PCredz - credentials/hash/credit card number sniffer
apt-get remove python-pypcap && apt-get install python-libpcap
cd /opt
git clone https://github.com/lgandx/PCredz

# Linux Kernel Exploit Suggester
cd /opt
git clone https://github.com/PenturaLabs/Linux_Exploit_Suggester

# Responder
cd /opt
git clone https://github.com/Spiderlabs/Responder

# clusterd.py
cd /opt
git clone https://github.com/hatRiot/clusterd.git

# F5 BIG-IP Cookie decoder
mkdir /opt/BIG-IP
cd /opt/BIG-IP
wget http://www.taddong.com/tools/BIG-IP_cookie_decoder.zip
unzip BIG-IP_cookie_decoder.zip
echo -e "#\!/bin/bash\npython /opt/BIG-IP/BIG-IP_cookie_decoder.py \$(curl -i -k \$1 2>/dev/null | grep -i \"Set-Cookie: BIGip\" | cut -d ' ' -f 2 | tr -d ';' | cut -d '=' -f 2)" > /opt/BIG-IP/big-ip-url.sh

# Various extra Windows binaries
mkdir /opt/windows-extras
cd /opt/windows-extras
wget http://www.tightvnc.com/download/1.3.10/tightvnc-1.3.10_x86.zip
wget http://download.sysinternals.com/files/PSTools.zip
wget http://download.sysinternals.com/files/AccessChk.zip

# smbexec
cd /opt
git clone https://github.com/pentestgeek/smbexec
cd smbexec
echo 1 | ./install.sh
echo 4 | ./install.sh

# Metasploit-Plugins from darkoperator - includes the pentest plugin
cd /opt
git clone https://github.com/darkoperator/Metasploit-Plugins
ln -sn /opt/Metasploit-Plugins/*.rb /usr/share/metasploit-framework/plugins/

# Veil-Evasion
cd /opt
git clone https://github.com/Veil-Framework/Veil-Evasion/
cd Veil-Evasion/setup
./setup.sh

# discover:
cd /opt
git clone https://github.com/leebaird/discover
cd discover
./setup.sh

# sslscan + openssl w/ sslv2 support (could break Kali):
#cd /opt
#git clone https://github.com/rbsec/sslscan.git
#cd sslscan
#./build_openssl_debian.sh
#make


# Firefox (not Iceweasel)
mkdir -p /opt/firefox-download
cd /opt/firefox-download

wget -r -l 1 -nd -np -nH -A bz2 https://download-installer.cdn.mozilla.net/pub/firefox/releases/latest/linux-x86_64/en-US/

cd /opt

for f in /opt/firefox-download/*.bz2 ; do tar -xjvf "$f" ; done

rm -rfv /opt/firefox-download


# Setup limited user for running Firefox
cd /opt/pentest-scripts
script_name=firefox-nonroot iw_user=firefox-user program_description="Firefox (Non-Root)"  command_line="/opt/firefox/firefox" icon="/opt/firefox/browser/icons/mozicon128.png"  catagories="Network;" ./setup-x-limited.sh 
