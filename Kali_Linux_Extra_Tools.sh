#!/bin/bash

##
## Kali Linux: Extra tools and customizations script
## =================================================
## Created by Wh1t3Rh1n0
##
## This script adds a bunch of my favorite tools to Kali Linux.
##
## Usage: ./Kali_Linux_Extra_Tools.sh install
##
## Unattended install (skips Veil install script):
##   ./Kali_Linux_Extra_Tools.sh install unattended
##

if [ "$1" == "" ] || [ "$1" == "-h" ] || [ "$1" == "--help" ]; then
    grep "^##" "$0"
    exit
fi

if [ "$1" != "install" ]; then exit ; fi


# ====== Kali Linux Extra Tools ======
apt-get update && apt-get -y upgrade && apt-get -y dist-upgrade

# Configuration changes (convenience)
echo -e "\nPATH=\$PATH:/opt/pentest-scripts" >> /root/.bashrc
#update-rc.d postgresql enable
#update-rc.d metasploit enable
update-rc.d network-manager disable
ln -sn /usr/share/metasploit-framework/tools/pattern_create.rb /usr/bin/pattern_create
ln -sn /usr/share/metasploit-framework/tools/pattern_offset.rb /usr/bin/pattern_offset


# Firefox/Iceweasel Add-ons
# -------------------------
#echo "Opening Iceweasel to install addons..."

mkdir -p /opt/firefox-addons
cd /opt/firefox-addons

#https://addons.mozilla.org/en-US/firefox/addon/open-multiple-locations/
curl -L "https://addons.mozilla.org/firefox/downloads/latest/216803/addon-216803-latest.xpi" -o open-multiple-locations.xpi

#https://addons.mozilla.org/en-US/firefox/addon/restclient/?src=search
curl -L "https://addons.mozilla.org/firefox/downloads/latest/9780/addon-9780-latest.xpi" -o restclient.xpi

#https://addons.mozilla.org/en-US/firefox/addon/refcontrol/?src=search
curl -L "https://addons.mozilla.org/firefox/downloads/latest/953/addon-953-latest.xpi" -o refcontrol.xpi

#https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/?src=ss
curl -L "https://addons.mozilla.org/firefox/downloads/file/308568/foxyproxy_standard-4.5.4-sm+tb+fx.xpi" -o foxyproxy.xpi

#https://addons.mozilla.org/en-US/firefox/addon/firebug/?src=search
curl -L "https://addons.mozilla.org/firefox/downloads/latest/1843/addon-1843-latest.xpi" -o firebug.xpi 

#https://addons.mozilla.org/en-US/firefox/addon/cookies-manager-plus/?src=ss
curl -L "https://addons.mozilla.org/firefox/downloads/latest/92079/addon-92079-latest.xpi" -o cookies-manager-plus.xpi

#https://addons.mozilla.org/en-US/firefox/addon/unhide-passwords/
curl -L "https://addons.mozilla.org/firefox/downloads/latest/462/addon-462-latest.xpi" -o unhide-passwords.xpi

#https://addons.mozilla.org/en-US/firefox/addon/hackbar/?src=search
curl -L "https://addons.mozilla.org/firefox/downloads/latest/3899/addon-3899-latest.xpi" -o hackbar.xpi

#https://addons.mozilla.org/en-US/firefox/addon/tamper-data/?src=search
curl -L "https://addons.mozilla.org/firefox/downloads/latest/966/addon-966-latest.xpi" -o tamper-data.xpi

#https://addons.mozilla.org/en-US/firefox/addon/quickjava/?src=search
curl -L "https://addons.mozilla.org/firefox/downloads/file/82987/quickjava-1.7.2-fx.xpi" -o quickjava.xpi

#https://addons.mozilla.org/en-US/firefox/addon/parent-folder/
curl -L "https://addons.mozilla.org/firefox/downloads/latest/1800/addon-1800-latest.xpi" -o parent-folder.xpi

#https://addons.mozilla.org/en-US/firefox/addon/user-agent-quick-switch
curl -L "https://addons.mozilla.org/firefox/downloads/latest/355807/addon-355807-latest.xpi" -o user-agent-quick-switch.xpi

#https://addons.mozilla.org/en-US/firefox/addon/email-extractor
curl -L "https://addons.mozilla.org/firefox/downloads/latest/410578/addon-410578-latest.xpi" -o email-extractor.xpi

#https://addons.mozilla.org/en-US/firefox/addon/autofill-262804/
curl -L "https://addons.mozilla.org/firefox/downloads/latest/262804/addon-262804-latest.xpi" -o autofill.xpi

#https://addons.mozilla.org/en-US/firefox/addon/unhide-fields


#https://addons.mozilla.org/en-US/firefox/addon/adblock-plus/?src=search
curl -L "https://addons.mozilla.org/firefox/downloads/latest/1865/addon-1865-latest.xpi" -o adblock-plus.xpi

#https://addons.mozilla.org/en-us/firefox/addon/checkcompatibility/
curl -L "https://addons.mozilla.org/firefox/downloads/latest/300254/addon-300254-latest.xpi" -o disable-addon-compatibility-checks.xpi


# Tools you must download manually
# --------------------------------

# PHP File Manager - for easy upload/download over kali's apache or victim's HTTP server
# http://phpfm.sourceforge.net/


# Tools installed with apt-get
# ----------------------------

# cifs-utils -> mount.cifs - mount SMB shares as local directories
# sshfs - mount SSH servers
# sshpass - pass ssh passwords in the command-line (scripting, preventing typos)
# vinagre - a more fully-featured VNC/RDP client
apt-get install -y cifs-utils sshfs sshpass vinagre

# Tools based on personal preference
apt-get install -y terminator gedit hexchat gnome-tweak-tool

# Other stuff that comes in handy
apt-get install -y flashplugin-nonfree icedtea-plugin
apt-get install -y gimp
apt-get install -y libreoffice-gnome libreoffice-writer libreoffice-calc

apt-get install -y chromium-browser
# Fix so chromium runs as root
sed -Ei "s#CHROMIUM_FLAGS=.+#CHROMIUM_FLAGS=\"--password-store=detect --user-data-dir\"#" /etc/chromium/default

apt-get install -y wicd
service wicd stop
update-rc.d wicd disable

# Clean up
apt-get --purge autoremove
apt-get clean


# Scripted, non-apt-get installs
# ------------------------------

# xwd
cd /opt
wget "http://xorg.freedesktop.org/archive/individual/app/xwd-1.0.5.tar.bz2"
tar -xjvf xwd-1.0.5.tar.bz2
rm xwd-1.0.5.tar.bz2
cd xwd-1.0.5
./configure ; make ; make install

# TCP Ping
cd /usr/bin
wget "http://www.vdberg.org/~richard/tcpping"
chmod 755 tcpping
ln -sn /usr/bin/tcpping /usr/bin/tcping

# Sublime text editor
cd /opt
if [ "$(arch)" == "x86_64" ] ; then
    wget "http://c758482.r82.cf2.rackcdn.com/Sublime%20Text%202.0.2%20x64.tar.bz2" -O sublime.tar.bz2
else
    wget "http://c758482.r82.cf2.rackcdn.com/Sublime%20Text%202.0.2.tar.bz2" -O sublime.tar.bz2
fi
tar -xjvf sublime.tar.bz2
rm -fv sublime.tar.bz2
ln -sn "/opt/Sublime Text 2/sublime_text" /usr/bin/sublime


# Wordlists ###
cd /usr/share/wordlists
# Top 10k most common passwords: 
# # Link is currently broken
# #curl -L "https://xato.net/files/10k%20most%20common.zip" -o "10k most common.zip"
# Top 100 passwords from the Adobe leak: http://stricture-group.com/files/adobe-top100.txt
# * This one needs some formatting:
curl "http://stricture-group.com/files/adobe-top100.txt" | grep "^[0-9]*\." | awk -F " " {'print $4'} > /usr/share/wordlists/adobe-top-100.txt
# Default passwords list: 
wget "http://www.phenoelit.org/dpl/dpl.html"

# merger.py -> nessus-merger.py
wget "https://gist.githubusercontent.com/mastahyeti/2720173/raw" -O /tmp/merger.py
echo \#\!/usr/bin/env python > /usr/share/nessus-merger.py
cat /tmp/merger.py >> /usr/share/nessus-merger.py
chmod 755 /usr/share/nessus-merger.py
rm /tmp/merger.py

# VNCpwd - VNC Password Decrypter
mkdir /opt/vncpwd
cd /opt/vncpwd
wget "http://aluigi.altervista.org/pwdrec/vncpwd.zip"
unzip vncpwd.zip

# PCredz - credentials/hash/credit card number sniffer
apt-get remove python-pypcap && apt-get install python-libpcap
cd /opt
git clone https://github.com/lgandx/PCredz

# Linux Kernel Exploit Suggester
cd /opt
git clone https://github.com/PenturaLabs/Linux_Exploit_Suggester

# Responder
cd /opt
git clone https://github.com/Spiderlabs/Responder

# clusterd.py
cd /opt
git clone https://github.com/hatRiot/clusterd.git

# F5 BIG-IP Cookie decoder
mkdir /opt/BIG-IP
cd /opt/BIG-IP
wget http://www.taddong.com/tools/BIG-IP_cookie_decoder.zip
unzip BIG-IP_cookie_decoder.zip
echo -e "#\!/bin/bash\npython /opt/BIG-IP/BIG-IP_cookie_decoder.py \$(curl -i -k \$1 2>/dev/null | grep -i \"Set-Cookie: BIGip\" | cut -d ' ' -f 2 | tr -d ';' | cut -d '=' -f 2)" > /opt/BIG-IP/big-ip-url.sh

# Various extra Windows binaries
mkdir /opt/windows-extras
cd /opt/windows-extras
wget http://www.tightvnc.com/download/1.3.10/tightvnc-1.3.10_x86.zip
wget http://download.sysinternals.com/files/PSTools.zip
wget http://download.sysinternals.com/files/AccessChk.zip

# smbexec
cd /opt
git clone https://github.com/pentestgeek/smbexec
cd smbexec
echo 1 | ./install.sh
echo 4 | ./install.sh

# Metasploit-Plugins from darkoperator - includes the pentest plugin
cd /opt
git clone https://github.com/darkoperator/Metasploit-Plugins
ln -sn /opt/Metasploit-Plugins/*.rb /usr/share/metasploit-framework/plugins/

# Veil-Evasion
cd /opt
git clone https://github.com/Veil-Framework/Veil-Evasion/
cd Veil-Evasion/setup
if [ "$2" != "unattended" ] ; then
    ./setup.sh
fi

# discover:
cd /opt
git clone https://github.com/leebaird/discover
cd discover
./setup.sh

# sslscan + openssl w/ sslv2 support (could break Kali):
#cd /opt
#git clone https://github.com/rbsec/sslscan.git
#cd sslscan
#./build_openssl_debian.sh
#make


# Firefox (not Iceweasel)
mkdir -p /opt/firefox-download
cd /opt/firefox-download
wget -r -l 1 -nd -np -nH -A bz2 https://download-installer.cdn.mozilla.net/pub/firefox/releases/latest/linux-x86_64/en-US/
cd /opt
for f in /opt/firefox-download/*.bz2 ; do tar -xjvf "$f" ; done
rm -rfv /opt/firefox-download


# Setup limited user for running Firefox
cd /opt/pentest-scripts
script_name=firefox-nonroot iw_user=firefox-user program_description="Firefox (Non-Root)"  command_line="/opt/firefox/firefox" icon="/opt/firefox/browser/icons/mozicon128.png"  catagories="Network;" ./setup-x-limited.sh 


# Setup limited user for running Hexchat
cd /opt/pentest-scripts
script_name=hexchat-nonroot iw_user=hexchat-user program_description="Hexchat (Non-Root)" command_line=/usr/bin/hexchat icon="hexchat" catagories="Network;" ./setup-x-limited.sh


# Create 'readall' convenience script
cat << EOF > /usr/bin/readall
#!/bin/bash -v
chmod -R o+r /var/www
chmod -R o+r /home/samba
EOF
chmod +x /usr/bin/readall



