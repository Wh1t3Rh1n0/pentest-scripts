#!/bin/bash
# ----------------------------------
# setup-x-limited.sh | by Wh1t3Rh1n0 
# ----------------------------------

# This script creates a script and a menu icon for executing a given program
# as a regular, non-root user while you are logged in as root. Fully tested
# with Kali Linux 1.0.7 where I do not like running my web browser, IRC 
# client, etc. as root, but logging in as root is so convenient for everything
# else.

### SETTINGS ###
# Change the values below to set this script up for the desired program.

# script_name is the filename that the created script will be saved as.
#script_name=iceweasel-nonroot

# iw_user is the user that will be created for the purpose of running the
# target program.
#iw_user=iceweasel-user

# program_description is the name that will show on the icon.
#program_description="Iceweasel (Non-Root)"

# command_line is the path of the target program to be run.
#command_line="/usr/bin/iceweasel"

# icon is the icon to display on the menu. If unknown, you can find it by
# examining /usr/share/applications/<program name>.desktop
#icon="iceweasel"

# categories determines where the icon is placed within the applications menu.
# Like icon, if you don't know it, you can find it in 
# /usr/share/applications/<program name>.desktop
#catagories="Network;"

### END OF SETTINGS ###


useradd -G audio,pulse,pulse-access $iw_user
mkdir /home/$iw_user
chown -R $iw_user /home/$iw_user


cat << EOF > /usr/bin/$script_name
#!/bin/bash
cp \$XAUTHORITY /home/$iw_user/.Xauth
chmod 400 /home/$iw_user/.Xauth
chown $iw_user /home/$iw_user/.Xauth
sudo -u $iw_user -i XAUTHORITY=/home/$iw_user/.Xauth $command_line \$*
EOF
chmod 555 /usr/bin/$script_name


cat << EOF > /usr/share/applications/$script_name.desktop
[Desktop Entry]
Encoding=UTF-8
Name=$program_description
Comment=$program_description
GenericName=$program_description
X-GNOME-FullName=$program_description
Exec=/usr/bin/$script_name
Terminal=false
X-MultipleArgs=false
Type=Application
Icon=$icon
Categories=$catagories
StartupNotify=true
EOF



### Below is automatic compatibility tracking for future versions of Kali ###
echo \# Last tested [`date`] on [`cat /etc/issue | tr -d "\n"`] >> $0

# Last tested [Thu Feb 12 15:55:40 EST 2015] on [Kali GNU/Linux 1.1.0 \n \l]
# Last tested [Thu Feb 12 15:56:13 EST 2015] on [Kali GNU/Linux 1.1.0 \n \l]
