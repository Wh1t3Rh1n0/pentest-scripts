#!/bin/bash

##
## gnmap2ip
## --------
## Converts a .gnmap file to an list of colon separated IP and TCP port numbers.
##
## Usage: gnmap2ip [GNMAP FILE]
##
## Requires: grep
## Limitations: Only handles TCP ports. Ignores UDP ports. 
##

if [ "$1" == "" ] || [ "$1" == "-h" ] || [ "$1" == "--help" ] ; then
    grep "^##" "$0"
    exit
fi

GNMAP_FILE=$1

for ip in $(grep -ioE "[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+" $GNMAP_FILE) ; do 
    for port in $(grep "$ip" $GNMAP_FILE | grep -ioE "[0-9]+/open/tcp" | grep -ioE "[0-9]+" | sort -u ); do
        echo "$ip:$port"
    done
done

