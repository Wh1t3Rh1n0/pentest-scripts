#!/usr/bin/env python

import sys

if len(sys.argv) == 1 or "-h" in sys.argv or "--help" in sys.argv:
    print """
gnmap2ip
--------
Converts a .gnmap file to an list of colon separated IP and TCP port numbers.

Usage: gnmap2ip [GNMAP FILE]
"""
    sys.exit()
    
    
gnmap_file = sys.argv[1]

f = open(gnmap_file, 'r')
lines = [l.rstrip() for l in f.readlines()]
f.close()

for line in lines:
    if line.find("open") != -1:
        ip_address = line.split(' ')[1]
        port_data = line.split(':')[2].split('\t')[0].split(' ')

        for entry in port_data:
            if entry.find("open") != -1 and entry.find("tcp") != -1:
                port = entry.strip().split('/')[0]
                print "%s:%s" % (ip_address, port)
