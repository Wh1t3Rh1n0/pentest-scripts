#!/bin/bash

##
## grip
## ----
## greps a file for common patterns.
##
## Should accept most standard grep flags.
##
## Example usage - IPv4 addresses only:
##    grep for IPv4 addresses only:     grip <filename>
##    include CIDR notation:            grip --cidr <filename>
##    grep for IP:Port:                 grip --port <filename>
##
## Example usage - IPv6 addresses only:
##    grep for IPv6 addresses only:     grip --6 <filename>
##    include CIDR notation:            grip --6cidr <filename>
##
## Other supported patterns:
##    grep for emails:                  grip --email <filename>
##    grep for MAC addresses:           grip --mac <filename>

##

if [ "$1" == "--help" ] || [ "$1" == "-h" ] ; then
    grep -E '^## ?' "$0" | sed -E 's/^## ?//g'
    exit
fi

if [ "$1" == "--port" ] ; then
    grep -iEo "(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(:[0-9]+)?" $(echo $* | sed 's/--port//g')
    exit
fi

if [ "$1" == "--email" ] ; then
    grep -Eoa '[A-Za-z0-9\._+-]+@[A-Za-z0-9\._-]+' $(echo $* | sed 's/--email//g')
    exit
fi

if [ "$1" == "--cidr" ] ; then
    grep -iEoa "(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(/[0-9]+)?" $(echo $* | sed 's/--cidr//g')
    exit
fi

if [ "$1" == "--mac" ] ; then
    grep -iEao '([abcdef0-9]{2}[:-]){5}[abcdef0-9]{2}' $(echo $* | sed 's/--mac//g')
    exit
fi

# The second grep command in each IPv6 example is there to prevent MAC addresses from being detected as IPv6 addresses
if [ "$1" == "--6" ] ; then
    grep -iEao '[0-9a-f]{0,4}:([0-9a-f]*:){1,6}[0-9a-z]{0,4}' $(echo $* | sed 's/--6//g') | grep -Eia '::|:.*:.*:.*:.*:.*:.*:.*'

    exit
fi

if [ "$1" == "--6cidr" ] ; then
    grep -iEao '[0-9a-f]{0,4}:([0-9a-f]*:){1,6}[0-9a-z]{0,4}(/[0-9]+)?' $(echo $* | sed 's/--6cidr//g') | grep -Eia '::|:.*:.*:.*:.*:.*:.*:.*'
    exit
fi

# Default behavior - grep for IPv4 IP addresses only
grep -iEao "(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])" $*
