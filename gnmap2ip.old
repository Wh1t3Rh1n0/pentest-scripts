#!/bin/bash

##
## gnmap2ip
## --------
## Converts a .gnmap file to an list of colon separated IP and TCP port numbers.
##
## Usage: gnmap2ip [GNMAP FILE]
##
## Requires: grep
## Limitations: Only handles TCP ports. Ignores UDP ports. 
##

if [ "$1" == "" ] || [ "$1" == "--help" ] || [ "$1" == "-h" ] ; then
    grep -E '^## ?' "$0" | sed -E 's/^## ?//g'
    exit
fi

GNMAP_FILE=$1

for ip in $( grep "/open/tcp" $GNMAP_FILE | cut -d ' ' -f 2 | sort -u) ; do 
    for port in $(grep -E "$ip \(\)" $GNMAP_FILE | grep -ioE "[0-9]+/open/tcp" | grep -ioE "[0-9]+" | sort -u ); do
        echo "$ip:$port"
    done
done

